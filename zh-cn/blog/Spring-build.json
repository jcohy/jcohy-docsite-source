{
  "filename": "Spring-build.md",
  "__html": "<h2>一、如何构建SpringBoot源码</h2>\n<h4>1、环境准备</h4>\n<p>JDK8 以上。</p>\n<h4>2、下载SpringBoot源码</h4>\n<p>我们可以在github上下载SpringBoot源码，本文下载的是SpringBoot最新的版本 2.2.3.RELEASE。下载地址：</p>\n<pre><code class=\"language-java\">https:<span class=\"hljs-comment\">//codeload.github.com/spring-projects/spring-boot/tar.gz/v2.2.3.RELEASE</span>\n</code></pre>\n<h4>3、解压</h4>\n<p>我们将下载后的文件上传到服务器上，解压。我这里上传到了 /home 目录下</p>\n<pre><code class=\"language-shell\">tar -zxvf  spring-boot-2.2.3.RELEASE.tar.gz\n</code></pre>\n<h4>4、修改配置</h4>\n<p>SpringBoot 是使用 Maven 构建的，并提供了 maven-wrapper ，这样我们就无须下载安装 Maven 也可以进行构建。SpringBoot项目在构建中也使用了 Gradle。这一点需要注意。\n为了加速构建，我们这里可以修改一下参数：</p>\n<p>首先我们看一下SpringBoot的目录结构</p>\n<p><img src=\"http://docs.jcohy.com/img/spring-boot1.png\" alt=\"image-20200119133128642\"></p>\n<ul>\n<li>\n<p>修改内存大小</p>\n<p>默认maven构建时的内存大小为 1536m，我们可以根据本机实际内存进行修改，不然会出错。。修改下面的文件。</p>\n<pre><code>root --&gt; ./mvn --&gt; jvm.config\n</code></pre>\n</li>\n<li>\n<p>修改pom文件。在 repositories 标签和 pluginRepositories 分别加入</p>\n<pre><code class=\"language-xml\">  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">repository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>spring-release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Spring Release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.spring.io/release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">repository</span>&gt;</span>\n</code></pre>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>aliyunmaven<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>aliyunmaven Release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://maven.aliyun.com/nexus/content/groups/public<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n</code></pre>\n<p>修改后的部分pom如下：</p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">repositories</span>&gt;</span>\n  <span class=\"hljs-comment\">&lt;!-- Repositories to allow snapshot and milestone BOM imports during development.\n This section is stripped by the flatten plugin during install/deploy. --&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">repository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>spring-release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Spring Release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.spring.io/release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">repository</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">repository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>central<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">snapshots</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>false<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">snapshots</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">repository</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">repository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>spring-milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Spring Milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">snapshots</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>false<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">snapshots</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">repository</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">repository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>spring-snapshot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Spring Snapshot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">snapshots</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>true<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">snapshots</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">repository</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">repository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>rabbit-milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Rabbit Milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://dl.bintray.com/rabbitmq/maven-milestones<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">snapshots</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>false<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">snapshots</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">repository</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">repositories</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pluginRepositories</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>aliyunmaven<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>aliyunmaven Release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://maven.aliyun.com/nexus/content/groups/public<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>central<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">snapshots</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>false<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">snapshots</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>spring-release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Spring Release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.spring.io/release<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>spring-milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Spring Milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.spring.io/milestone<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">snapshots</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>false<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">snapshots</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span>&gt;</span>spring-snapshot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">id</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>Spring Snapshot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">url</span>&gt;</span>https://repo.spring.io/snapshot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">url</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">snapshots</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>true<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">snapshots</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pluginRepository</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pluginRepositories</span>&gt;</span>\n</code></pre>\n</li>\n<li>\n<p>修改 build.gradle 文件</p>\n<pre><code class=\"language-shell\">cd /home/spring-boot-2.2.3.RELEASE/spring-boot-project/spring-boot-tools/spring-boot-gradle-plugin\nvim build.gradle\n</code></pre>\n<p>修改后的文件如下：</p>\n<pre><code class=\"language-groovy\">buildscript {\n\trepositories {\n\t\tmaven { url <span class=\"hljs-string\">\"https://maven.aliyun.com/nexus/content/groups/public/\"</span> }\n\t\tmavenLocal()\n\t\tmavenCentral()\n\t}\n\tdependencies {\n\t\tclasspath(<span class=\"hljs-string\">\"io.spring.javaformat:spring-javaformat-gradle-plugin:0.0.15\"</span>)\n\t}\n}\n\nplugins {\n\tid <span class=\"hljs-string\">'java'</span>\n\tid <span class=\"hljs-string\">'eclipse'</span>\n}\n\napply <span class=\"hljs-string\">plugin:</span> <span class=\"hljs-string\">'io.spring.javaformat'</span>\n\nrepositories {\n\tmaven { url <span class=\"hljs-string\">\"https://maven.aliyun.com/nexus/content/groups/public/\"</span> }\n\tmavenLocal()\n\tmavenCentral()\n}\n\ndependencies {\n\timplementation localGroovy()\n\timplementation gradleApi()\n\timplementation fileTree(<span class=\"hljs-string\">dir:</span> <span class=\"hljs-string\">'target/dependencies/compile'</span>, <span class=\"hljs-string\">include:</span> <span class=\"hljs-string\">'*.jar'</span>)\n\ttestImplementation gradleTestKit()\n\ttestImplementation <span class=\"hljs-string\">'org.apache.commons:commons-compress:1.13'</span>\n\ttestImplementation fileTree(<span class=\"hljs-string\">dir:</span> <span class=\"hljs-string\">'target/dependencies/test'</span>, <span class=\"hljs-string\">include:</span> <span class=\"hljs-string\">'*.jar'</span>)\n}\n\njar {\n\tmanifest {\n\t\tattributes <span class=\"hljs-string\">'Implementation-Version'</span>: (version ? version : <span class=\"hljs-string\">'unknown'</span>)\n\t}\n}\n\ntest {\n\tuseJUnitPlatform()\n\ttestLogging {\n\t\tevents <span class=\"hljs-string\">\"passed\"</span>, <span class=\"hljs-string\">\"skipped\"</span>, <span class=\"hljs-string\">\"failed\"</span>\n\t}\n}\n\njavadoc {\n\toptions {\n\t\tauthor()\n\t\tstylesheetFile = file(<span class=\"hljs-string\">'src/main/javadoc/spring-javadoc.css'</span>)\n\t\tlinks = [\n\t\t\t<span class=\"hljs-string\">'https://docs.oracle.com/javase/8/docs/api/'</span>,\n\t\t\t<span class=\"hljs-string\">'https://docs.gradle.org/current/javadoc/'</span>\n\t\t]\n\t\tsource = <span class=\"hljs-string\">'8'</span>\n\t}\n\ttitle = <span class=\"hljs-string\">\"${project.description} $version API\"</span>\n}\n\ntask sourcesJar(<span class=\"hljs-string\">type:</span> Jar) {\n\tclassifier = <span class=\"hljs-string\">'sources'</span>\n\tfrom sourceSets.main.allSource\n}\n\ntask javadocJar(<span class=\"hljs-string\">type:</span> Jar) {\n\tclassifier = <span class=\"hljs-string\">\"javadoc\"</span>\n\tfrom javadoc\n}\n\nartifacts {\n\tarchives sourcesJar\n\tarchives javadocJar\n}\n</code></pre>\n<h4>5、源码构建</h4>\n</li>\n<li>\n<p>构建</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> 下面的命令会将执行所有测试用例，所以消耗时间比较长。</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> ./mvnw clean install</span>\n<span class=\"hljs-meta\">#</span><span class=\"bash\"> 如果不需要执行测试用例，可以使用以下命令</span>\n<span class=\"hljs-meta\">$</span><span class=\"bash\"> ./mvnw clean install -DskipTests</span>\n</code></pre>\n</li>\n<li>\n<p>构建参考文档首先要构建 Maven 插件。</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> ./mvnw clean install -pl spring-boot-project/spring-boot-tools/spring-boot-maven-plugin -Pdefault,full</span>\n</code></pre>\n</li>\n<li>\n<p>该文档还包括自动生成 Starter 的一些信息。 您可能已经将其存储在本地存储库中（第一步），但是如果要刷新它，可以执行以下命令</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> ./mvnw clean install -f spring-boot-project/spring-boot-starters</span>\n</code></pre>\n</li>\n<li>\n<p>构建参看文档</p>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> ./mvnw clean prepare-package -pl spring-boot-project/spring-boot-docs -Pdefault,full</span>\n</code></pre>\n<h4>6、更快</h4>\n<p>由于SpringBoot引入的依赖比较多，所有在执行第一步的时候还是比较耗时，为了更快的构建，我已经将 SpringBoot 2.2.3.RELEASE 构建需要的 Jar 包打包。共享到百度云盘，大家只需要下载，解压到maven本地存储库中，即可。</p>\n<pre><code class=\"language-shell\">百度云链接：\n链接：https://pan.baidu.com/s/1a9NGtgxzvdVtpnetQACudQ \n提取码：lqmh \n\n默认解压目录：\nLinux：./root/.m2\nwindowns:C:\\Users\\PC\\.m2\n</code></pre>\n</li>\n</ul>\n<h2>一、如何构建Sagan源码</h2>\n<h4>1、下载源码</h4>\n<pre><code class=\"language-java\">https:<span class=\"hljs-comment\">//github.com/spring-io/sagan</span>\n</code></pre>\n<h4>2、进入 sagan-client ,修改 webpack.config.js</h4>\n<p>找到下面这句</p>\n<pre><code class=\"language-json\">            {\n                test: /.*\\/fonts\\/.*/,\n                loader: 'file-loader',\n                options: {\n                    name: 'fonts/[name].[ext]',\n                },\n            },\n</code></pre>\n<p>修改为：</p>\n<pre><code class=\"language-text\">\n            {\n                test: /\\.(ttf|eot|woff|woff2|svg)$/,\n                loader: 'file-loader',\n                options: {\n                    name: 'fonts/[name].[ext]',\n                },\n            },\n</code></pre>\n<h4>3、添加阿里云镜像，加速构建</h4>\n<p>在 sagan-common,sagan-renderer,sagan-site 模块中找到 repositories 标签添加阿里云仓库</p>\n<pre><code>maven {url 'http://maven.aliyun.com/nexus/content/groups/public/' }\n</code></pre>\n<h4>4、构建</h4>\n<pre><code class=\"language-shell\">    \n    //windowns\n    gradlew.bat build\n    \n    ./gradlew :sagan-site:bootRun\n\n</code></pre>\n",
  "link": "\\zh-cn\\blog\\Spring-build.html",
  "meta": {
    "title": "如何构建Spring系列源码",
    "keywords": "spring, 构建,Spring Boot 2.2.3.RELEASE",
    "description": "如何构建SpringBoot源码"
  }
}