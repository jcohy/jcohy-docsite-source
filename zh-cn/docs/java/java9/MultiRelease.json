{
  "filename": "MultiRelease.md",
  "__html": "<h2>多版本兼容jar包</h2>\n<h3>官方Feature</h3>\n<ul>\n<li>238: Multi-Release JAR Files</li>\n</ul>\n<blockquote>\n<p>当一个新版本的Java出现的时候，你的库用户要花费数年时间才会切换到这个新的版本。这就意味着库得去向后兼容你想要支持的最老的Java版本（许多情况下就是Java 6 或者 Java7）。这实际上意味着未来的很长一段时间，你都不能在库中运用Java 9所提供的新特性。幸运的是，多版本兼容jar功能能让你创建仅在特定版本的Java环境中运行库程序选择使用的class版本。</p>\n</blockquote>\n<h3>概述</h3>\n<pre><code class=\"language-java\">jar root\n  - A<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>\n  - <span class=\"hljs-title\">B</span>.<span class=\"hljs-title\">class</span>\n  - <span class=\"hljs-title\">C</span>.<span class=\"hljs-title\">class</span>\n  - <span class=\"hljs-title\">D</span>.<span class=\"hljs-title\">class</span>\n  - <span class=\"hljs-title\">META</span>-<span class=\"hljs-title\">INF</span>\n     - <span class=\"hljs-title\">versions</span>\n        - 9\n           - <span class=\"hljs-title\">A</span>.<span class=\"hljs-title\">class</span>\n           - <span class=\"hljs-title\">B</span>.<span class=\"hljs-title\">class</span>\n        - 10\n           - <span class=\"hljs-title\">A</span>.<span class=\"hljs-title\">class</span>\n</span></code></pre>\n<p>说明：\n在上述场景中， root.jar 可以在 Java 9 中使用, 不过 A或B 类使用的不是顶层的 root.A或root.B 这两个class, 而是处在“META-INF/versions/9”下面的这两个。这是特别为 Java 9 准备的 class 版本，可以运用 Java 9 所提供的特性和库。在将来的支持Java 10 JDK上，它将看到A的jdk 10特定版本和B的jdk 9特定版本；同时，在早期的 Java 诸版本中使用这个 JAR 也是能运行的，因为较老版本的 Java 只会看到顶层的A类或 B 类。</p>\n<h3>使用</h3>\n<p>1、创建一个类,使用java 9 版本语法</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">import</span> java.util.Set;\n<span class=\"hljs-comment\">/**\n * Created by jiac on 2017/12/28 0028.\n */</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Generator</span> </span>{\n        \n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Set&lt;String&gt; <span class=\"hljs-title\">createStrings</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">return</span> Set.of(<span class=\"hljs-string\">\"Java\"</span>, <span class=\"hljs-string\">\"9\"</span>);\n    }\n\n}\n</code></pre>\n<p>2、创建一个同名类,使用java 8版本语法</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">import</span> java.util.Set;\n<span class=\"hljs-keyword\">import</span> java.util.HashSet;\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Generator</span> </span>{\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Set&lt;String&gt; <span class=\"hljs-title\">createStrings</span><span class=\"hljs-params\">()</span> </span>{\n        Set&lt;String&gt; strings = <span class=\"hljs-keyword\">new</span> HashSet&lt;String&gt;();\n        strings.add(<span class=\"hljs-string\">\"Java\"</span>);\n        strings.add(<span class=\"hljs-string\">\"8\"</span>);\n        <span class=\"hljs-keyword\">return</span> strings;\n    }\n}\n</code></pre>\n<p>3、创建测试类</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Application</span> </span>{\n   <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">testMultiJar</span><span class=\"hljs-params\">()</span></span>{\n      Generator gen = <span class=\"hljs-keyword\">new</span> Generator();\n      System.out.println(<span class=\"hljs-string\">\"Generated strings: \"</span> + gen.createStrings());\n   }\n}\n</code></pre>\n<p>4、打包</p>\n<pre><code class=\"language-shell\">javac -d build --release 8 src/main/java/com/jcohy/study/*.java\njavac -d build9 --release 9 src/main/java9/com/jcohy/study/*.java\njar --create --main-class=Application --file multijar.jar -C build . --release 9 -C build9 .\n</code></pre>\n",
  "link": "\\zh-cn\\docs\\java\\java9\\MultiRelease.html",
  "meta": {
    "title": "多版本兼容jar包",
    "keywords": "docs,jcohy-docs,java9,多版本兼容jar包",
    "description": "多版本兼容jar包"
  }
}